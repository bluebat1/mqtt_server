var p=(e,o,n)=>new Promise((d,c)=>{var t=u=>{try{i(n.next(u))}catch(h){c(h)}},l=u=>{try{i(n.throw(u))}catch(h){c(h)}},i=u=>u.done?d(u.value):Promise.resolve(u.value).then(t,l);i((n=n.apply(e,o)).next())});import{_ as v,c as _,b as s,t as r,o as a,d as C,F as b,r as x,u as m,e as k,f as w,g as U,h as q,w as g,i as F,j as M,k as f,v as y,l as A,m as D,K as B,a as E}from"./_plugin-vue_export-helper-c6f7907f.js";const $={post(e,o,n,d){let c=new FormData;for(const t in o)c.append(t,o[t]);window.axios.post(e,c,{}).then(t=>{let l=t.data;n(l)}).catch(t=>{(t.response||t.request)&&d()})},postAwait(e,o){return new Promise((n,d)=>{let c=new FormData;for(const t in o)c.append(t,o[t]);window.axios.post(e,c,{}).then(t=>{let l=t.data;n(l)}).catch(t=>{(t.response||t.request)&&d(t)})})}},S={data(){return{nodeAccountMax:"999",nodeAccountResidue:"999",nodeAccountCount:"999",TopicMax:"999",TopicCount:"999",TopicResidue:"999"}}},V={class:"container"},I=s("hr",null,null,-1),T={class:"row"},L={class:"col"},N={class:"card"},P={class:"card-body"},H=s("h4",{class:"card-title"},"节点账户资源",-1),R={class:"card-text"},z={class:"col"},K={class:"card"},Q={class:"card-body"},Z=s("h4",{class:"card-title"},"当前节点账户数量",-1),j={class:"card-text"},G={class:"col"},J={class:"card"},O={class:"card-body"},W=s("h4",{class:"card-title"},"剩余节点账户资源",-1),X={class:"card-text"},Y=s("hr",null,null,-1),ss={class:"row"},ts={class:"col"},os={class:"card"},es={class:"card-body"},cs=s("h4",{class:"card-title"},"主题资源",-1),is={class:"card-text"},ns={class:"col"},ds={class:"card"},ls={class:"card-body"},rs=s("h4",{class:"card-title"},"当前主题数量",-1),as={class:"card-text"},us={class:"col"},_s={class:"card"},hs={class:"card-body"},ps=s("h4",{class:"card-title"},"剩余主题资源",-1),vs={class:"card-text"};function ms(e,o,n,d,c,t){return a(),_("div",V,[I,s("div",T,[s("div",L,[s("div",N,[s("div",P,[H,s("p",R,r(c.nodeAccountMax),1)])])]),s("div",z,[s("div",K,[s("div",Q,[Z,s("p",j,r(c.nodeAccountCount),1)])])]),s("div",G,[s("div",J,[s("div",O,[W,s("p",X,r(c.nodeAccountResidue),1)])])])]),Y,s("div",ss,[s("div",ts,[s("div",os,[s("div",es,[cs,s("p",is,r(c.TopicMax),1)])])]),s("div",ns,[s("div",ds,[s("div",ls,[rs,s("p",as,r(c.TopicCount),1)])])]),s("div",us,[s("div",_s,[s("div",hs,[ps,s("p",vs,r(c.TopicResidue),1)])])])])])}const ws=v(S,[["render",ms]]),gs={class:"container"},$s=k('<div class="row"><div class="col"><div class="btn btn-success">添加主题</div></div></div><hr><div class="row"><div class="col"> 主题 </div><div class="col"> 订阅量 </div><div class="col"> 消息总量 </div><div class="col"> 操作 </div></div><hr>',4),fs={class:"theme-list"},ys={class:"col"},As={class:"col"},bs={class:"col"},xs={class:"col"},ks=["onClick"],Cs=["onClick"],Us=["onClick"],qs=s("hr",null,null,-1),Fs=C({__name:"topic",setup(e){let o=[];for(let t=0;t<20;t++)o.push({topic:"主题"+t,subscribeNum:Math.floor(Math.random()*100),msgNum:Math.floor(Math.random()*100)});let n=t=>{console.log(t)},d=t=>{console.log(t)},c=t=>{console.log(t)};return(t,l)=>(a(),_("div",gs,[$s,s("div",fs,[(a(!0),_(b,null,x(m(o),(i,u)=>(a(),_("div",{class:"row",key:u},[s("div",ys,r(i.topic),1),s("div",As,r(i.subscribeNum),1),s("div",bs,r(i.msgNum),1),s("div",xs,[s("div",{class:"btn btn-danger",style:{"margin-right":"5px"},onClick:h=>m(n)(i.topic)},"删除",8,ks),s("div",{class:"btn btn-success",style:{"margin-right":"5px"},onClick:h=>m(d)(i.topic)},"查看订阅者 ",8,Cs),s("div",{class:"btn btn-success",style:{"margin-right":"5px"},onClick:h=>m(c)(i.topic)},"查看消息",8,Us)]),qs]))),128))])]))}}),Ms={data(){return{isShow:!1}},methods:{show(){this.isShow=!0},hied(){this.isShow=!1}}};const Ds={key:0,class:"popup"},Bs={class:"card box"},Es={class:"card-header"},Ss={class:"card-body"},Vs={class:"card-footer"};function Is(e,o,n,d,c,t){return c.isShow?(a(),_("div",Ds,[s("div",Bs,[s("div",Es,[w(e.$slots,"header",{},void 0,!0)]),s("div",Ss,[w(e.$slots,"default",{},void 0,!0)]),s("div",Vs,[w(e.$slots,"footer",{},void 0,!0)])])])):U("",!0)}const Ts=v(Ms,[["render",Is],["__scopeId","data-v-fc2cb179"]]),Ls={data(){return{mqttUserAccountInput:"",mqttUserPasswdInput:"",mqttUserAddHint:"",userList:[]}},components:{popup:Ts},methods:{delMqttUser(e){console.log(e)},addMqttUserShow(){let e=this;e.mqttUserAddHint="",e.$refs.addUserPopup.show()},addMqttUser(){return p(this,null,function*(){let e=this,o=e.mqttUserAccountInput,n=e.mqttUserPasswdInput;try{if((/[^a-z|A-Z|0-9]/g.test(o)||/[^a-z|A-Z|0-9]/g.test(n))&&(e.mqttUserAddHint="【账号、密码】不能包含【字母、数字以】外的字符"),o.length<6){e.mqttUserAddHint="账号长度不能小于 6 .";return}if(n.length<6){e.mqttUserAddHint="密码长度不能小于 6 .";return}let d=yield $.postAwait("/server/addMqttUser",{})}catch(d){console.error(d),alert("添加失败！")}})}},mounted(){return p(this,null,function*(){try{let e=yield $.postAwait("/server/getMqttUserList",{token:localStorage.getItem("token")});if(e.state!="ok")throw"";let o=[];e.data.forEach(n=>{o.push({uid:Math.floor(Math.random()*999999999),user:n.user,passwd:n.passwd,date:n.date})}),this.userList=o}catch(e){alert("获取节点列表失败")}})}},Ns={class:"container"},Ps={class:"row"},Hs={class:"col"},Rs=k('<hr><div class="row"><div class="col"> 用户名 </div><div class="col"> 密码 </div><div class="col"> 创建时间 </div><div class="col"> 操作 </div></div><hr>',3),zs={class:"user-list"},Ks={class:"col"},Qs={class:"col"},Zs={class:"col"},js={class:"col"},Gs=["onClick"],Js=s("hr",null,null,-1),Os=s("td",null,"账号：",-1),Ws=s("td",null,"密码：",-1),Xs={style:{color:"red"}};function Ys(e,o,n,d,c,t){const l=F("popup");return a(),_("div",Ns,[s("div",Ps,[s("div",Hs,[s("div",{class:"btn btn-success",onClick:o[0]||(o[0]=(...i)=>t.addMqttUserShow&&t.addMqttUserShow(...i))},"添加账号")])]),Rs,s("div",zs,[(a(!0),_(b,null,x(c.userList,(i,u)=>(a(),_("div",{class:"row",key:i.uid},[s("div",Ks,r(i.user),1),s("div",Qs,r(i.passwd),1),s("div",Zs,r(i.date),1),s("div",js,[s("div",{class:"btn btn-danger",style:{"margin-right":"5px"},onClick:h=>t.delMqttUser(i.topic)},"删除",8,Gs)]),Js]))),128))]),q(l,{ref:"addUserPopup"},{header:g(()=>[M("添加MQTT账户")]),default:g(()=>[s("table",null,[s("tbody",null,[s("tr",null,[Os,s("td",null,[f(s("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=i=>c.mqttUserAccountInput=i)},null,512),[[y,c.mqttUserAccountInput]])])]),s("tr",null,[Ws,s("td",null,[f(s("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=i=>c.mqttUserPasswdInput=i)},null,512),[[y,c.mqttUserPasswdInput]])])])])]),s("span",Xs,r(c.mqttUserAddHint),1)]),footer:g(()=>[s("div",{class:"btn btn-success",style:{float:"right"},onClick:o[3]||(o[3]=(...i)=>t.addMqttUser&&t.addMqttUser(...i))},"确定")]),_:1},512)])}const st=v(Ls,[["render",Ys]]),tt={};function ot(e,o,n,d,c,t){return a(),_("div",null," supervisor ")}const et=v(tt,[["render",ot]]),ct={setup(){return{}},data(){return{nowView:"home"}},components:{home:ws,topic:Fs,users:st,supervisory:et},methods:{loginCheck(){return p(this,null,function*(){{try{if((yield $.postAwait("/server/checkLogin",{user:localStorage.getItem})).status!="ok")return}catch(e){console.log(e)}location.href="./login.html"}})},loginExit(){localStorage.removeItem("user"),localStorage.removeItem("token"),location.href="login.html"},gotoView(e){this.nowView=e}},mounted(){return p(this,null,function*(){this.loginCheck()})}};const it={class:"container-fluid"},nt={class:"row header"},dt=s("div",{class:"col"},"MQTT 控制后台",-1),lt=s("div",{class:"col"},null,-1),rt={class:"col"},at={class:"row"},ut={class:"col-2 side"},_t={class:"list-group"},ht={class:"col-10 main",style:{"padding-top":"10px"}};function pt(e,o,n,d,c,t){return a(),_("div",null,[s("div",it,[s("div",nt,[dt,lt,s("div",rt,[s("div",{class:"btn btn-success",style:{float:"right"},onClick:o[0]||(o[0]=(...l)=>t.loginExit&&t.loginExit(...l))},"退出")])]),s("div",at,[s("div",ut,[s("ul",_t,[s("li",{class:"list-group-item",onClick:o[1]||(o[1]=l=>t.gotoView("home"))},"首页"),s("li",{class:"list-group-item",onClick:o[2]||(o[2]=l=>t.gotoView("topic"))},"主题管理"),s("li",{class:"list-group-item",onClick:o[3]||(o[3]=l=>t.gotoView("users"))},"用户管理"),s("li",{class:"list-group-item",onClick:o[4]||(o[4]=l=>t.gotoView("supervisory"))},"实时监控")])]),s("div",ht,[(a(),A(B,null,[(a(),A(D(c.nowView)))],1024))])])])])}const vt=v(ct,[["render",pt]]);E(vt).mount("#app");
